<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Pro</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
margin:0;
background:#070b14;
color:#fff;
font-family:sans-serif;
padding:20px;
}

/* cards */
.card{
background:#121826;
border-radius:22px;
padding:20px;
margin:15px 0;
box-shadow:0 8px 20px rgba(0,0,0,.3)
}

/* credit progress */
.credit-wrap{
background:#e7eef5;
color:#000;
border-radius:22px;
padding:20px;
margin:15px 0
}

.bar-bg{
height:10px;
background:#d4d4d4;
border-radius:20px;
margin:15px 0
}

.bar{
height:10px;
background:#0d9488;
border-radius:20px
}

.pay-btn{
background:linear-gradient(45deg,#7c3aed,#d946ef);
border:none;
color:#fff;
padding:8px 14px;
border-radius:12px;
margin-top:10px
}

.badge{
padding:3px 10px;
border-radius:10px;
font-size:12px
}

.paid{background:#10b981}
.unpaid{background:#ef4444}

canvas{
width:100%!important;
height:250px!important
}
</style>
</head>

<body>

<h2>Dashboard</h2>

<div id="netWorth"></div>
<div id="credit"></div>
<div id="bills"></div>

<div class="card">
<h3>Growth</h3>
<canvas id="bar"></canvas>
</div>

<script>

/* ⭐ API URL डालो */
const API_URL="https://script.google.com/macros/s/AKfycbz36nSCy2AZw7Hsu3D-8irGuFwNsop1vhANiefLeFNNPwp58szIBnfvKBcFWzrBn4s-VA/exec";

/* ⭐ formatter */
const fmt=n=>new Intl.NumberFormat('en-IN',{style:'currency',currency:'INR'}).format(Number(n)||0);

/* ⭐ NET WORTH */
async function loadNet(){
const res=await fetch(API_URL,{method:"POST",body:JSON.stringify({action:"getDashboardPlus"})}).then(r=>r.json());

document.getElementById("netWorth").innerHTML=`
<div class="card">
<h3>NET WORTH</h3>
<h2>${fmt(res.currentNetWorth)}</h2>
Assets: ${fmt(res.assets)}<br>
Liabilities: ${fmt(res.liabilities)}
</div>`;
}

/* ⭐ CREDIT */
async function loadCredit(){
const res=await fetch(API_URL,{method:"POST",body:JSON.stringify({action:"getDashboard"})}).then(r=>r.json());

const used=res.cardLiab;
const limit=res.cardLimit;
const avail=limit-used;
const per=(used/limit)*100;

document.getElementById("credit").innerHTML=`
<div class="credit-wrap">
<div style="display:flex;justify-content:space-between">
<div>
Used<br><b>${fmt(used)}</b>
</div>
<div>
Available<br><b>${fmt(avail)}</b>
</div>
</div>

<div class="bar-bg">
<div class="bar" style="width:${per}%"></div>
</div>

<center>Total Credit Limit: ${fmt(limit)}</center>
</div>`;
}

/* ⭐ BILLS */
async function loadBills(){

await fetch(API_URL,{method:"POST",body:JSON.stringify({action:"generateBills"})});

const res=await fetch(API_URL,{method:"POST",body:JSON.stringify({action:"getBills"})}).then(r=>r.json());

let html="";

res.bills.forEach(b=>{
const due=new Date(b.dueDate);
const diff=Math.ceil((due-new Date())/(1000*60*60*24));

html+=`
<div class="card">
<b>${b.card}</b>
<div style="display:flex;justify-content:space-between">
<div>
Bill<br>${fmt(b.amount)}<br>
Due date<br>${due.toLocaleDateString()}
</div>

<div>
<span class="badge ${b.status}">${b.status}</span>
${b.status!=="paid"?`<br><button class="pay-btn" onclick="payBill('${b.id}',${b.amount})">PAY</button>`:""}
</div>
</div>
</div>`;
});

document.getElementById("bills").innerHTML=html;
}

async function payBill(id,amt){
await fetch(API_URL,{method:"POST",body:JSON.stringify({action:"payBill",billId:id,amount:amt})});
loadBills();
}

/* ⭐ BAR CHART */
async function loadBar(){
const snap=await fetch(API_URL,{method:"POST",body:JSON.stringify({action:"getSnapshots"})}).then(r=>r.json());

new Chart(document.getElementById('bar'),{
type:'bar',
data:{
labels:snap.months,
datasets:[{
label:'Net Worth',
data:snap.netWorth,
backgroundColor:'#22c55e'
}]
}
});
}

/* ⭐ loader */
window.onload=()=>{
loadNet();
loadCredit();
loadBills();
loadBar();
}

</script>

</body>
</html>
