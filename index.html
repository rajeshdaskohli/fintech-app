<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wealth App</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
margin:0;
background:#070b14;
color:#fff;
font-family:sans-serif;
padding:18px
}

/* glass card */
.card{
background:linear-gradient(145deg,#121826,#0e1420);
border-radius:24px;
padding:20px;
margin:16px 0;
box-shadow:0 10px 30px rgba(0,0,0,.4)
}

/* bill card */
.bill{
background:linear-gradient(145deg,#121826,#0e1420);
border-radius:24px;
padding:20px;
margin:16px 0;
box-shadow:0 10px 30px rgba(0,0,0,.4)
}

/* row */
.row{
display:flex;
justify-content:space-between;
font-size:14px;
margin-top:7px
}

/* progress */
.progress{
height:8px;
border-radius:10px;
background:#222;
margin-top:12px;
overflow:hidden
}

.progress span{
display:block;
height:100%;
background:#10b981
}

/* badge */
.badge{
padding:4px 10px;
border-radius:14px;
font-size:11px
}

.paid{background:#10b981}
.unpaid{background:#f59e0b}
.overdue{background:#ef4444}

/* pay button */
.pay{
margin-top:14px;
padding:9px 16px;
border:none;
border-radius:14px;
background:linear-gradient(135deg,#7c3aed,#38bdf8);
color:#fff;
font-weight:700
}

/* bar card */
.bar-card{
background:#0f1d17;
border-radius:24px;
padding:20px;
margin:16px 0
}
</style>
</head>

<body>

<h2>Dashboard</h2>

<div id="netWorth"></div>
<div id="credit"></div>
<div id="bills"></div>

<div class="card">
<h3>Growth</h3>
<canvas id="bar"></canvas>
</div>

<script>

const API_URL="https://script.google.com/macros/s/AKfycbwIp-46Qpj-8hsGOccLLzUok6nFffhHLU1quDlIe4c5lC3GPq3MuKTTbbvokrAbZOisTw/exec";

/* formatter */
const fmt=n=>new Intl.NumberFormat('en-IN',{
style:'currency',currency:'INR'
}).format(Number(n)||0);

/* NET WORTH */
async function loadNetWorth(){
const r=await fetch(API_URL,{
method:"POST",
body:JSON.stringify({action:"getDashboardPlus"})
}).then(r=>r.json());

document.getElementById("netWorth").innerHTML=`
<div class="card">
<h3>NET WORTH</h3>
<h2>${fmt(r.currentNetWorth)}</h2>
Assets: ${fmt(r.assets)}<br>
Liabilities: ${fmt(r.liabilities)}
</div>`;
}

/* CREDIT */
async function loadCredit(){
const r=await fetch(API_URL,{
method:"POST",
body:JSON.stringify({action:"getDashboard"})
}).then(r=>r.json());

const used=r.cardLiab||0;
const limit=r.cardLimit||0;
const avail=limit-used;

document.getElementById("credit").innerHTML=`
<div class="card">
<h3>CREDIT</h3>
<div class="row"><span>Used</span><span>${fmt(used)}</span></div>
<div class="row"><span>Available</span><span>${fmt(avail)}</span></div>
<div class="row"><span>Limit</span><span>${fmt(limit)}</span></div>
</div>`;
}

/* BILLS */
async function loadBills(){

await fetch(API_URL,{method:"POST",body:JSON.stringify({action:"generateBills"})});

const r=await fetch(API_URL,{
method:"POST",
body:JSON.stringify({action:"getBills"})
}).then(r=>r.json());

let html="";

r.bills.forEach(b=>{

const due=new Date(b.dueDate);
const diff=Math.ceil((due-new Date())/(1000*60*60*24));

let badge="unpaid";
if(b.status==="paid") badge="paid";
if(b.overdue) badge="overdue";

const percent=Math.min((b.amount/100000)*100,100);

html+=`
<div class="bill">
<b>${b.card}</b>

<div class="row"><span>Bill</span><span>${fmt(b.amount)}</span></div>
<div class="row"><span>Due</span><span>${diff>0?diff+" days":"Overdue"}</span></div>

<div class="progress"><span style="width:${percent}%"></span></div>

<div class="row">
<span>Status</span>
<span class="badge ${badge}">${b.status}</span>
</div>

${b.status!=="paid"?`<button class="pay" onclick="pay('${b.id}',${b.amount})">Pay Now</button>`:""}
</div>`;
});

document.getElementById("bills").innerHTML=html;
}

/* PAY */
async function pay(id,amt){
await fetch(API_URL,{
method:"POST",
body:JSON.stringify({action:"payBill",billId:id,amount:amt})
});
loadBills();
}

/* BAR GROWTH */
async function loadBar(){
const r=await fetch(API_URL,{
method:"POST",
body:JSON.stringify({action:"getSnapshots"})
}).then(r=>r.json());

new Chart(document.getElementById("bar"),{
type:"bar",
data:{
labels:r.months,
datasets:[{
data:r.netWorth,
backgroundColor:"#2f855a"
}]
},
options:{
plugins:{legend:{display:false}},
scales:{x:{grid:{display:false}},y:{grid:{color:"#1a2"}}}
}
});
}

/* LOAD */
window.onload=()=>{
loadNetWorth();
loadCredit();
loadBills();
loadBar();
}

</script>

</body>
</html>
