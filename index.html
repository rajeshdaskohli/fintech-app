<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wealth App</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
--bg:#070b14;--card:#121826;--text:#f8fafc;--text-dim:#94a3b8;
--primary:#38bdf8;--green:#10b981;--red:#ef4444;--border:rgba(255,255,255,.05);
}
body{margin:0;background:var(--bg);color:var(--text);font-family:sans-serif;padding:20px}

.card{background:var(--card);border-radius:28px;padding:20px;margin:15px 0;border:1px solid var(--border)}
.title{font-size:11px;color:var(--text-dim);font-weight:800}
.value{font-size:26px;font-weight:800;margin:8px 0}

.row{display:flex;justify-content:space-between;font-size:12px}

.bar{height:8px;background:var(--border);border-radius:10px;overflow:hidden;margin-top:8px}
.fill{height:100%;background:var(--green)}

.gauge{
height:120px;width:120px;border-radius:50%;
background:conic-gradient(var(--green) 0deg,var(--border) 0deg);
display:flex;align-items:center;justify-content:center;margin:auto;font-weight:800
}

.scroll{overflow-x:auto}
canvas{min-width:700px}
</style>
</head>

<body>

<h2>Dashboard Pro</h2>

<div id="netWorthCards"></div>

<div id="alertsBox"></div>

<div id="creditGauge"></div>

<div id="loanProgress"></div>

<div class="scroll">
  
  <div style="display:flex;gap:10px;margin:10px 0">
<button onclick="setChart('line')">Graph</button>
<button onclick="setChart('bar')">Bar</button>
</div>
<canvas id="nwChart"></canvas>
</div>

<script>

const API_URL="https://script.google.com/macros/s/AKfycbzHM706UvlpAi8rgH1Z4Z68UnsTIrhHr9vyUtrJVCY8TNN9jHBpXoat_HffhMCPatfVeQ/exec";

const fmt=n=> new Intl.NumberFormat('en-IN',{style:'currency',currency:'INR'}).format(Number(n)||0);

let chartInstance=null;
let chartType='line';
let targetValue=200000; // ⭐ wealth goal

function setChart(type){
  chartType=type;
  loadChart();
}

/* ⭐ DASHBOARD */
async function loadDashboard(){
const res = await fetch(API_URL,{
method:"POST",
body:JSON.stringify({action:"getDashboardPlus"})
}).then(r=>r.json());

const trend=res.profitLoss>=0?'↑':'↓';

document.getElementById("netWorthCards").innerHTML=`
<div class="card">
<div class="title">NET WORTH</div>
<div class="value">${fmt(res.currentNetWorth)} ${trend}</div>
<div class="row">
<span>Assets: ${fmt(res.assets)}</span>
<span>Liab: ${fmt(res.liabilities)}</span>
</div>
</div>
`;
}

/* ⭐ ANALYTICS CHART */
async function loadChart(){
async function loadAlerts(){
  const res = await fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({action:"getAlerts"})
  }).then(r=>r.json());

  document.getElementById("alertsBox").innerHTML =
    res.alerts.map(a=>`<div class="card">${a}</div>`).join("");
}
  
async function loadNetWorth(){
  const res = await fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({action:"getDashboardPlus"})
  }).then(r=>r.json());

  const diffClass = res.profitLoss>=0 ? 'profit' : 'loss';

  document.getElementById("netWorthCards").innerHTML=`
  <div class="net-card">
  <div class="net-title">NET WORTH</div>
  <div class="net-worth">${fmt(res.currentNetWorth)}</div>
  <div class="net-row">
  <span>Assets: ${fmt(res.assets)}</span>
  <span>Liab: ${fmt(res.liabilities)}</span>
  </div>
  <div class="net-row">
  <span class="${diffClass}">
  ${res.profitLoss>=0?'+':''}${fmt(res.profitLoss)}
  </span>
  </div>
  </div>`;
}
loadNetWorth();
loadChart();
loadAlerts();

const snap = await fetch(API_URL,{
method:"POST",
body:JSON.stringify({action:"getSnapshots"})
}).then(r=>r.json());

const labels=snap.months.map(m=>new Date(m).toLocaleDateString('en-IN',{month:'short',year:'2-digit'}));
const values=snap.netWorth;

/* ⭐ FORECAST */
const last=values[values.length-1]||0;
const forecast=[...values,last*1.05,last*1.1];

if(chartInstance) chartInstance.destroy();

chartInstance=new Chart(document.getElementById('nwChart'),{
type:chartType,
data:{
labels:[...labels,'F1','F2'],
datasets:[
{
label:'Net Worth',
data:values,
borderColor:'#38bdf8',
backgroundColor:chartType==='bar'
?values.map(v=>v>=0?'#10b981':'#ef4444')
:'#10b981',
tension:.3,
borderRadius:10
},
{
label:'Forecast',
data:forecast,
borderColor:'#f59e0b',
borderDash:[5,5],
tension:.3
},
{
label:'Target',
data:new Array(labels.length+2).fill(targetValue),
borderColor:'#ef4444',
borderDash:[2,2]
}
]
},
options:{
responsive:true,
plugins:{legend:{display:true}}
}
});

}

loadDashboard();
loadChart();

</script>

</body>
</html>
