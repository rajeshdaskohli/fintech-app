<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wealth App</title>

<style>
:root{
--bg:#070b14;--card:#121826;--text:#f8fafc;--text-dim:#94a3b8;
--primary:#38bdf8;--green:#10b981;--red:#ef4444;--border:rgba(255,255,255,.05);
}
body{margin:0;background:var(--bg);color:var(--text);font-family:sans-serif;padding:20px}

.net-card{background:var(--card);border-radius:28px;padding:20px;margin:15px 0;border:1px solid var(--border)}
.net-title{font-size:11px;color:var(--text-dim);font-weight:800}
.net-worth{font-size:26px;font-weight:800;margin:8px 0}
.net-row{display:flex;justify-content:space-between;font-size:12px}

.scroll{overflow-x:auto}
canvas{min-width:700px}
button{padding:8px 12px;border-radius:10px;border:none}
</style>
</head>

<body>

<h2>Dashboard Pro</h2>

<div id="netWorthCards"></div>
<div id="alertsBox"></div>

<div style="display:flex;gap:10px;margin:10px 0">
<button onclick="setChart('line')">Graph</button>
<button onclick="setChart('bar')">Bar</button>
</div>

<div class="scroll">
<canvas id="nwChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>

const API_URL="https://script.google.com/macros/s/AKfycbzHM706UvlpAi8rgH1Z4Z68UnsTIrhHr9vyUtrJVCY8TNN9jHBpXoat_HffhMCPatfVeQ/exec";

const fmt=(n)=> new Intl.NumberFormat('en-IN',{style:'currency',currency:'INR'}).format(Number(n)||0);

let chartType='line';
let chartInstance=null;

/* ⭐ NET WORTH */
async function loadNetWorth(){
const res=await fetch(API_URL,{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({action:"getDashboardPlus"})
}).then(r=>r.json());

const diffClass=res.profitLoss>=0?'#10b981':'#ef4444';

document.getElementById("netWorthCards").innerHTML=`
<div class="net-card">
<div class="net-title">NET WORTH</div>
<div class="net-worth">${fmt(res.currentNetWorth)}</div>
<div class="net-row">
<span>Assets: ${fmt(res.assets)}</span>
<span>Liab: ${fmt(res.liabilities)}</span>
</div>
<div class="net-row">
<span style="color:${diffClass}">
${res.profitLoss>=0?'+':''}${fmt(res.profitLoss)}
</span>
</div>
</div>`;
}

/* ⭐ ALERTS */
async function loadAlerts(){
const res=await fetch(API_URL,{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({action:"getDashboard"})
}).then(r=>r.json());

let html="";
if(res.utilization>70) html+=`<div class="net-card">⚠ High credit utilization</div>`;
if(res.netWorth<0) html+=`<div class="net-card">⚠ Net worth negative</div>`;

document.getElementById("alertsBox").innerHTML=html;
}

/* ⭐ CHART */
async function loadChart(){

const snap=await fetch(API_URL,{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({action:"getSnapshots"})
}).then(r=>r.json());

const labels=snap.months;
const values=snap.netWorth;

if(chartInstance) chartInstance.destroy();

chartInstance=new Chart(document.getElementById('nwChart'),{
type:chartType,
data:{
labels,
datasets:[{
label:'Net Worth',
data:values,
borderColor:'#38bdf8',
backgroundColor:chartType==='bar'
?values.map(v=>v>=0?'#10b981':'#ef4444')
:'rgba(56,189,248,0.4)',
tension:0.3,
borderRadius:10
}]
},
options:{
responsive:true,
plugins:{legend:{display:true}}
}
});
}

/* ⭐ TOGGLE */
function setChart(type){
chartType=type;
loadChart();
}

/* ⭐ LOAD ALL */
window.addEventListener("DOMContentLoaded",()=>{
loadNetWorth();
loadAlerts();
loadChart();
});

</script>

</body>
</html>
